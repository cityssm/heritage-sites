"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{let e=[];const t=document.querySelector("#searchString"),a=document.querySelector("#searchResults"),r=document.querySelector("#heritageSiteModal"),o=document.querySelector("#heritageSiteMap");let i;const s=()=>{i&&(i.remove(),i=void 0,o.innerHTML=""),r.classList.remove("is-active"),document.querySelector("html").classList.remove("is-clipped"),document.querySelector("main").removeAttribute("inert")},n=()=>{s();const e=window.location.hash;let r=a.querySelector("a[href='"+e+"']");r||(r=t),window.location.hash="",Promise.resolve().then(()=>{r.focus()})},d=()=>{const t=window.location.hash.slice(1).toLowerCase();s();const a=e.find(e=>e.siteId.toLowerCase()===t);if(a)if("TRUE"===a.hasPage?(r.querySelector("[data-field='page']").innerHTML='<p class="pt-4 has-text-centered"><i class="fas fa-3x fa-spin fa-circle-notch has-text-grey-lighter"></i><br /><em class="has-text-grey">Loading details...</em></p>',window.fetch("pages/"+a.siteId+".htm").then(e=>e.text()).then(e=>{r.querySelector("[data-field='page']").innerHTML=e;const t=r.querySelectorAll("[data-field='page'] a");if(t&&t.length>0)for(const e of t)e.target="_blank";return!0}).catch(()=>{r.querySelector("[data-field='page']").innerHTML=""})):(r.querySelector("[data-field='page']").innerHTML="<h1></h1>",r.querySelector("[data-field='page'] h1").textContent=a.descriptionOfSite),r.querySelector("[data-field='civicAddress']").textContent=a.civicAddress,r.querySelector("[data-field='legalDescription']").textContent=a.legalDescription,r.querySelector("[data-field='ownerName']").textContent=a.ownerName,r.querySelector("[data-field='ownerAddress']").textContent=a.ownerAddress,r.classList.add("is-active"),document.querySelector("html").classList.add("is-clipped"),document.querySelector("main").setAttribute("inert","inert"),r.querySelector(".modal-card-body").scrollTop=0,r.querySelector(".modal-card-title").focus(),""!==a.latitude&&""!==a.longitude){const e=Number.parseFloat(a.latitude),t=Number.parseFloat(a.longitude);o.classList.remove("is-hidden"),i=L.map(o,{center:[e,t],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'}).addTo(i),L.marker({lon:t,lat:e}).bindPopup(a.descriptionOfSite).addTo(i)}else o.classList.add("is-hidden")},c=()=>{let r=0;const o=document.createElement("table");o.className="table is-fullwidth",o.innerHTML="<thead><tr><th>Description of Site</th><th>Bylaw Number</th><th>Site Type</th></tr></thead><tbody></tbody>";const i=t.value,s=i.toLowerCase().split(" "),n=new URL(window.location);""===i?n.search="":n.searchParams.set("searchString",i),window.history.pushState({},"",n);for(const t of e){let e=!0;for(const a of s)if(!t.searchString.includes(a)){e=!1;break}if(e){r+=1;const e=document.createElement("tr");e.innerHTML='<td><a class="has-text-weight-bold" data-field="descriptionOfSite"></a><br /><span data-field="civicAddress" title="Civic Address"></span></td><td><span data-field="bylawNumber" title="Bylaw Number"></span><br /><span data-field="datePassed" title="Date Passed"></span></td><td data-field="siteType"></td>';const a=e.querySelector("[data-field='descriptionOfSite']");a.href="#"+t.siteId,a.textContent=t.descriptionOfSite,e.querySelector("[data-field='civicAddress']").textContent=t.civicAddress,e.querySelector("[data-field='bylawNumber']").textContent=t.bylawNumber,e.querySelector("[data-field='datePassed']").textContent=t.datePassed,e.querySelector("[data-field='siteType']").textContent=t.siteType,o.querySelector("tbody").append(e)}}a.innerHTML="",r>0?a.append(o):a.innerHTML='<div class="message is-info"><p class="message-body">No heritage sites have been found using the above search criteria.</p></div>'};if(""!==window.location.search){const e=new URL(window.location.href).searchParams.get("searchString");e&&(t.value=e)}window.fetch("data/heritageSites.json").then(e=>e.json()).then(t=>{e=t;for(const t of e)t.searchString=t.descriptionOfSite.toLowerCase()+" "+t.civicAddress.toLowerCase()+" "+t.keywords.toLowerCase();return""!==window.location.hash&&d(),c()}).catch(()=>{bulmaJS.alert({title:"Error Loading Heritage Sites",message:"Please refresh this page to try again.",contextualColorName:"danger",okButton:{text:"Refresh Now",callbackFunction:()=>{window.location.reload()}}})}),t.addEventListener("keyup",c),r.querySelector("#modal-button--close").addEventListener("click",n),document.addEventListener("keydown",e=>{r.classList.contains("is-active")&&"Escape"===e.key&&n()}),window.addEventListener("hashchange",d)})();