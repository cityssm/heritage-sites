"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{let e=[];const t=document.querySelector("#searchString"),r=document.querySelector("#searchResults"),a=document.querySelector("#heritageSiteModal"),o=document.querySelector("#heritageSiteMap");let s;const i=()=>{s&&(s.remove(),s=void 0,o.innerHTML=""),a.classList.remove("is-active"),document.querySelector("html").classList.remove("is-clipped"),document.querySelector("main").removeAttribute("inert")},n=()=>{i();const e=window.location.hash;let a=r.querySelector("a[href='"+e+"']");a||(a=t),window.location.hash="",Promise.resolve().then(()=>{a.focus()})},d=()=>{const t=window.location.hash.slice(1).toLowerCase();i();const r=e.find(e=>e.siteId.toLowerCase()===t);if(r)if("TRUE"===r.hasPage?(a.querySelector("[data-field='page']").innerHTML='<p class="pt-4 has-text-centered"><i class="fas fa-3x fa-spin fa-circle-notch has-text-grey-lighter"></i><br /><em class="has-text-grey">Loading details...</em></p>',window.fetch("pages/"+r.siteId+".htm").then(e=>e.text()).then(e=>(a.querySelector("[data-field='page']").innerHTML=e,!0)).catch(()=>{a.querySelector("[data-field='page']").innerHTML=""})):(a.querySelector("[data-field='page']").innerHTML="<h1></h1>",a.querySelector("[data-field='page'] h1").textContent=r.descriptionOfProperty),a.querySelector("[data-field='civicAddress']").textContent=r.civicAddress,a.querySelector("[data-field='legalDescription']").textContent=r.legalDescription,a.querySelector("[data-field='ownerName']").textContent=r.ownerName,a.querySelector("[data-field='ownerAddress']").textContent=r.ownerAddress,a.classList.add("is-active"),document.querySelector("html").classList.add("is-clipped"),document.querySelector("main").setAttribute("inert","inert"),a.querySelector(".modal-card-body").scrollTop=0,a.querySelector(".modal-card-title").focus(),""!==r.latitude&&""!==r.longitude){const e=Number.parseFloat(r.latitude),t=Number.parseFloat(r.longitude);o.classList.remove("is-hidden"),s=L.map(o,{center:[e,t],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'}).addTo(s),L.marker({lon:t,lat:e}).bindPopup(r.descriptionOfProperty).addTo(s)}else o.classList.add("is-hidden")},c=()=>{let a=0;const o=document.createElement("table");o.className="table is-fullwidth",o.innerHTML="<thead><tr><th>Description of Property</th><th>Bylaw Number</th></tr></thead><tbody></tbody>";const s=t.value,i=s.toLowerCase().split(" "),n=new URL(window.location);""===s?n.search="":n.searchParams.set("searchString",s),window.history.pushState({},"",n);for(const t of e){let e=!0;for(const r of i)if(!t.searchString.includes(r)){e=!1;break}if(e){a+=1;const e=document.createElement("tr");e.innerHTML='<td><a class="has-text-weight-bold" data-field="descriptionOfProperty"></a><br /><span data-field="civicAddress" title="Civic Address"></span></td><td><span data-field="bylawNumber" title="Bylaw Number"></span><br /><span data-field="datePassed" title="Date Passed"></span></td>';const r=e.querySelector("[data-field='descriptionOfProperty']");r.href="#"+t.siteId,r.textContent=t.descriptionOfProperty,e.querySelector("[data-field='civicAddress']").textContent=t.civicAddress,e.querySelector("[data-field='bylawNumber']").textContent=t.bylawNumber,e.querySelector("[data-field='datePassed']").textContent=t.datePassed,o.querySelector("tbody").append(e)}}r.innerHTML="",a>0?r.append(o):r.innerHTML='<div class="message is-info"><p class="message-body">No heritage sites have been found using the above search criteria.</p></div>'};if(""!==window.location.search){const e=new URL(window.location.href).searchParams.get("searchString");e&&(t.value=e)}window.fetch("data/heritageSites.json").then(e=>e.json()).then(t=>{e=t;for(const t of e)t.searchString=t.descriptionOfProperty.toLowerCase()+" "+t.civicAddress.toLowerCase()+" "+t.keywords.toLowerCase();return""!==window.location.hash&&d(),c()}).catch(()=>{bulmaJS.alert({title:"Error Loading Heritage Sites",message:"Please refresh this page to try again.",contextualColorName:"danger",okButton:{text:"Refresh Now",callbackFunction:()=>{window.location.reload()}}})}),t.addEventListener("keyup",c),a.querySelector("#modal-button--close").addEventListener("click",n),document.addEventListener("keydown",e=>{a.classList.contains("is-active")&&"Escape"===e.key&&n()}),window.addEventListener("hashchange",d)})();